// Page height isn't recalculated when nem elements are appended. This method
// does the job.
function adjustScreen() {
  var new_height = $('.content-wrapper').height() + $('#test-results').height()
                   + $('#error_explanation').height();
  $('.content-wrapper').height(new_height);
}

// Add tests cases results in the page.
function placeTestCasesResults() {
  // Display each result in the screen.
  <% @results.each_with_index do |result, index| %>
    // Div to put the result.
    var div = $(document.createElement('div'));

    <% if result[:correct] %>
      div.attr('class', 'alert alert-success text-left');
      div.append("<i class='icon fa fa-check'> <%= result[:test_case].title %></i>");
      div.append("<a href='#output' data-toggle='collapse' data-target='#output-<%= result[:test_case].id %>' class='pull-right'>Output</a>")
    <% else %>
      div.attr('class', 'alert alert-danger text-left');
      div.append("<i class='icon fa fa-close'> <%= result[:test_case].title %></i>");
      div.append("<a href='#output' data-toggle='collapse' data-target='#output-<%= result[:test_case].id %>' class='pull-right'>Output</a>")
    <% end %>

    $('#test-results').append(div);
    $('#test-results').append("<div id='output-<%= result[:test_case].id %>' class='collapse' style='background: white; border-radius: 5px; margin-bottom: 20px; padding: 5px 5px 5px 5px'><%= j(result[:output]) %></div>");
  <% end %>
}

// Remove form invalid submition message, if present.
$('#error_explanation').remove();

<% if @answer.content.empty? %>
  $('.fa.fa-refresh.fa-spin').remove();
  $('#new_answer').prepend(
    '<div id="error_explanation"> \
      <div class="alert alert-danger"> \
        Forne√ßa uma resposta! \
      </div> \
    </div>'
  );
<% else %>
  <% if @answer.correct? %>
    $('.fa.fa-refresh.fa-spin').replaceWith('<div id="answer-result"><i class="fa fa-circle text-green"></i> <span>Resposta correta</span></div>');
    placeTestCasesResults();
  <% else %>
    $('.fa.fa-refresh.fa-spin').replaceWith('<div id="answer-result"><i class="fa fa-circle text-red"></i> <span>Resposta incorreta</span></div>');
    placeTestCasesResults();
  <% end %>
<% end %>

adjustScreen();
